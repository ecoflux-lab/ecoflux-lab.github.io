<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>full_doc_first_stage_ini_files – EcoFlux Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/lab_logo/No_text_smaller.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">EcoFlux Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Documentation/index.html"> 
<span class="menu-text">Documentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Data.html"> 
<span class="menu-text">Field Sites &amp; Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../OutreachNews.html"> 
<span class="menu-text">Outreach and News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../PipelineDocumentation/PipelineDocumentation.html" aria-current="page"> 
<span class="menu-text">Pipeline Documentation</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ecoflux-lab"> <i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../PipelineDocumentation/5_Full_Doc_Features_Details_Advanced.html">5. Full Documentation: Features, Details, and Other Useful Information for Advanced Users</a></li><li class="breadcrumb-item"><a href="../PipelineDocumentation/5_3_Full_Doc_First_Stage_INI_Files.html">5.3 &nbsp; Full Documentation: First Stage INI files</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/PipelineDocumentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pipeline Documentation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/1_Motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Motivation: The Importance of Flux Data Standardization and Reproducibility</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/1_1_Note_High_Freq_Data_Processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.1 &nbsp; Note: High Frequency Data Processing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/2_SoftwareInstallation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Software Installation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_1_Install_Git_Optional.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.1 &nbsp; Install Software: Git (optional)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_2_Download_Biomet_Library.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.2 &nbsp; Download Biomet.net Library</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_3_Install_Matlab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.3 &nbsp; Install Software: Matlab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_4_Configure_Matlab_For_Biomet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.4 &nbsp; Configure Matlab for Biomet.net</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_5_Install_R_Studio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.5 &nbsp; Install Software: R/RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_6_Install_Python_Optional.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.6 &nbsp; Install Software: Python (optional)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/3_Data_Cleaning_Principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Data Cleaning Principles</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/4_Quick_Start_Tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Quick Start Tutorial - Recommended for First-Time Users</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/4_1_Quick_Start_Set_Up_Structure_Config.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.1 &nbsp; Quick Start Tutorial: Project Directory Structure and Matlab Configuration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/4_2_Quick_Start_Create_Database_Visualize_Contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.2 &nbsp; Quick Start Tutorial: Create Database from Raw Data and Visualize Contents</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/4_3_Quick_Start_Create_First_Stage_INI_File.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.3 &nbsp; Quick Start Tutorial: Create your First Stage INI File for Data Cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/4_4_Quick_Start_Create_Second_Stage_INI_File.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.4 &nbsp; Quick Start Tutorial: Create Your Second Stage INI File for Data Cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/4_5_Quick_Start_Third_Stage_Cleaning_And_Ameriflux_Output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.5 &nbsp; Quick Start Tutorial: Third Stage Cleaning and Converting to Ameriflux Output</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/5_Full_Doc_Features_Details_Advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Full Documentation: Features, Details, and Other Useful Information for Advanced Users</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/5_1_Full_Doc_Setup_Project_Directory_Structure_Details.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5.1 &nbsp; Full Documentation: Project Directory Structure and Matlab Configuration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/5_2_Full_Doc_Create_Database_From_Raw_Data_Inspect_Outputs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5.2 &nbsp; Full Documentation: Create Database from Raw Data and Inspect Contents</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/5_3_Full_Doc_First_Stage_INI_Files.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">5.3 &nbsp; Full Documentation: First Stage INI files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/5_4_Full_Doc_Second_Stage_INI_Files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5.4 &nbsp; Full Documentation: Second Stage INI Files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/5_5_Full_Doc_Third_Stage_Cleaning_And_Ameriflux_Output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5.5 &nbsp; Full Documentation: Third Stage Cleaning and Converting to Ameriflux Output</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/6_Data_Visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/6_1_Matlab_plotApp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6.1 &nbsp; Matlab plotApp</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/6_2_RShiny_App.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6.2 &nbsp; R-Shiny App</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/6_3_Other_Biomet_Plotting_Tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6.3 &nbsp; Other Biomet.net Plotting Tools</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/7_Troubleshooting_FAQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Troubleshooting and FAQ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/7_1_Recommended_Software_Versions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7.1 &nbsp; Recommended Software Versions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/7_2_Recently_Added_Features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7.2 &nbsp; Recently Added Features</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#full-documentation-first-stage-ini-files" id="toc-full-documentation-first-stage-ini-files" class="nav-link active" data-scroll-target="#full-documentation-first-stage-ini-files">5.3. &nbsp; Full Documentation: First Stage INI files</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="full-documentation-first-stage-ini-files" class="level2">
<h2 class="anchored" data-anchor-id="full-documentation-first-stage-ini-files">5.3. &nbsp; Full Documentation: First Stage INI files</h2>
<p><link rel="stylesheet" href="css/style.css"></p>
<p><strong>This section provides extensive details beyond the first-time set up in section 4, to help more advanced users. If you are creating INI files for the first time, we highly recommend following our quick-start tutorial: instructions for INI file creation begin in section 4.3.</strong></p>
<p>On this page:</p>
<ul>
<li><a href="#div_id_WhatAreINIs">What are INI files?</a></li>
<li><a href="#div_id_GeneralFirstStage">General outline for creating first stage INI file</a></li>
<li><a href="#div_id_RunFirstStage">Running first stage cleaning in Matlab</a></li>
<li><a href="#div_id_PropertiesFirstStage">Properties and parameters: first stage INI</a></li>
<li><a href="#div_id_Tags">Tags for dependent variables</a></li>
<li><a href="#div_id_GlobVar_Include">Global variables and include files</a></li>
<li><a href="#div_id_Outlier">Outlier detection</a></li>
<li><a href="#div_id_Overwrite">Overwrite feature</a></li>
<li><a href="#div_id_Eval">More about Evaluate and postEvaluate: order of operations</a></li>
<li><a href="#div_id_CreateFromAmeriflux">Creating INI file from Ameriflux data</a></li>
<li><a href="#div_id_SyntaxRules">Programming syntax rules for first and second stage INI files</a></li>
<li><a href="#div_id_TipsINI">Tips</a></li>
</ul>
<p><br></p>
<div id="div_id_WhatAreINIs">
<hr>
<section id="what-are-ini-files" class="level3">
<h3 class="anchored" data-anchor-id="what-are-ini-files">What are INI files?</h3>
<p>The INI files for a given flux site dictate how data is transferred from its raw format into a standardized, clean, and gap-filled format that can be used for scientific analysis. They provide instructions to a set of MATLAB and R scripts used to process data. Even though flux sites can be similar in set up, they are usually unique in some way (different sensors, loggers, record lengths, etc.), and the INI files provide a way to deal with these differences while standardizing the data across sites.</p>
<p>There are three files, one for each data cleaning stage. Before starting to create your own INI files, it is important that you complete all of section 2, read section 3, and complete sections 4.1 and 4.2 (which each have supplementary information in sections 5.1 and 5.2, respectively), so that you have the best chance of everything running smoothly.</p>
<!--To help you create and edit your own site-specific INI files, throughout the instructions we refer to a working example that cleans data from the Delta Salt Marsh (DSM) flux site in British Columbia [XXX revisit - will we do this?]. -->
</section></div>
<div id="div_id_GeneralFirstStage">
<hr>
<section id="general-outline-for-creating-your-first-stage-ini-file" class="level3">
<h3 class="anchored" data-anchor-id="general-outline-for-creating-your-first-stage-ini-file">General outline for creating your first stage INI file</h3>
<p>If you are doing this for the first time, you can obtain simplified template files from the quick-start instructions in section 4.3, and we recommend that you follow the tutorial in that section. These are the general steps to create your first stage INI (which usually requires the most work of the three stages):</p>
<ul>
<li><p>Using your duplicated first stage INI file or downloaded template file, rename it using your unique measurement site ID. For example, the first stage INI file for a site with siteID = ‘DSM’ is named <code>DSM_FirstStage.ini</code>. This exact naming convention is important for the pipeline libraries to locate and use the file.</p></li>
<li><p>Edit this first stage INI file, adding <em>just a few variables at a time</em> and test as you go (see subsection “Running first stage cleaning in Matlab” later on this page), before adding more variables. This will make troubleshooting much easier. The tutorial in section 4.3 gives step-by-step instructions for adding variables.</p></li>
<li><p>Details on INI file properties and parameters are listed in table 5.1 on this page.</p></li>
<li><p>In addition to the data cleaning principles previously outlined in section 3, keep in mind the following guidelines:</p>
<ol type="1">
<li>Select traces that are needed for future data analysis. Not all the measured variables from a site need to be here, only the ones that will be used in future analysis or those needed to improve cleaning, such as diagnostic variables.</li>
<li>Each first stage trace name should follow <a href="https://ameriflux.lbl.gov/data/aboutdata/data-variables/" target="_blank" rel="noopener noreferrer">Ameriflux guidelines</a> including positional qualifiers where relevant. Filenames from your raw database can be renamed here.</li>
<li>The original values can be altered; calibrations can be applied; units can be changed.</li>
<li>Apply basic filtering: (a) values can be removed if they exceed minMax thresholds; (b) values can be clamped to the thresholds if they exceed clampedMinMax values.</li>
<li>You can create dependencies between different traces. If one trace has some data points removed, all its dependent traces will also have those data points removed.</li>
<li>More complex user-defined processing can be applied to the trace using the very useful “Evaluate” option (also available in second stage cleaning). Matlab functions (user-written or <code>Biomet.net</code>) can be called from this statement. Multiple Matlab statements can be called from within the “Evaluate” string. <!-- Some rules for formatting apply here (see the existing SecondStage ini file for details and examples XXX DSM?).--></li>
</ol>
<p><em>Example for air temperature trace</em>: if you have an output variable from a Campbell Scientific data logger that represents your 2-m air temperature measurement named <code>MET_HMP_T_2m_Avg</code>, you would assign this variable name to the <code>inputFileName</code> parameter (figure 5.3A; yellow highlighted text). In this example, it would be renamed in this stage using the <code>variableName</code> parameter, as <code>TA_1_1_1</code>, following the <a href="https://ameriflux.lbl.gov/data/aboutdata/data-variables/" target="_blank" rel="noopener noreferrer">Ameriflux naming convention</a>.</p>
<p><img src="images/ini_files/ini_example1.jpg" alt="INIFiles:inputFileName1" width="500"></p>
<p><em>Figure 5.3A. Air temperature trace (<code>TA_1_1_1</code>) as defined in a first stage INI file, with input from <code>MET_HMP_T_2m_Avg</code> variable.</em></p>
<p>Other fields that need editing are highlighted in peach:</p>
<ul>
<li>Give a descriptive title to your trace;</li>
<li>Input the start date of measurements for this variable in matlab’s datenum format (YYYY,MM,DD);</li>
<li>Input the source folder into measurementType (Met/Flux/other; these should match up with different measurement systems, i.e., Met for the Campbell Scientific data example, and Flux for EddyPro data);</li>
<li>Check the units;</li>
<li>If known, input the instrument model and serial number (SN);</li>
<li>Importantly, <em>choose minMax bounds</em> that are appropriate for the climate of your site (values outside this range will become NaNs).</li>
<li>For details of all the parameters and their definitions, see the “Properties and parameters: first stage INI” subsection below.</li>
</ul>
<p>If you have more than one air temperature measurement, you would create more traces to assign these, and use the Ameriflux naming convention to distinguish and define their relative positions (figure 5.3B). <!--[XXX fix this, highest measurement height in profile must be TA_1_1_1]--></p>
<p><img src="images/ini_files/ini_example2.jpg" alt="INIFiles:inputFileName2" width="500"></p>
<p><em>Figure 5.3B. Second air temperature trace (<code>TA_1_2_1</code>) defined in the same first stage INI file, in this case for a different vertical position (height of 350 cm), with input from <code>MET_HMP_T_350cm_Avg</code> variable.</em></p></li>
</ul>
</section></div>
<p><br></p>
<div id="div_id_RunFirstStage">
<hr>
<section id="running-first-stage-cleaning-in-matlab" class="level3">
<h3 class="anchored" data-anchor-id="running-first-stage-cleaning-in-matlab">Running first stage cleaning in Matlab</h3>
<ul>
<li><p>Once you have a few variables in your INI file, test it by running the <code>fr_automated_cleaning.m</code> function in Matlab (part of <code>Biomet.net</code> library), using the following command:</p>
<pre><code>fr_automated_cleaning_(yearIn,'SITEID',1)</code></pre>
<p>where the arguments are defined as follows:</p>
<p><em>Table 5.3A. Argument definitions for <code>fr_automated_cleaning</code> function.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 55%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>yearIn</td>
<td>year(s) you wish to clean data for</td>
<td>integer or integer array</td>
</tr>
<tr class="even">
<td>SITEID</td>
<td>measurement site ID, e.g., ‘DSM’</td>
<td>string uppercase</td>
</tr>
<tr class="odd">
<td>cleaning stage to run</td>
<td>1 = first stage, 2 = second stage, 7 = third stage, 8 = convert to AmeriFlux CSV file</td>
<td>integer</td>
</tr>
</tbody>
</table></li>
<li><p>For example, to run first stage cleaning for the DSM site for 2022, you would type: <code>fr_automated_cleaning(2022,'DSM',1)</code>.</p></li>
<li><p>With this function, you can clean multiple years of data, e.g., <code>2020:2023</code>, and once you have your INI files set up for later cleaning stages you can also run multiple stages e.g., <code>[1 2 7]</code>. Earlier stages must have been run at least once before running subsequent stages, so the appropriate data files exist as input for the next stage.</p></li>
</ul>
</section></div>
<p><br></p>
<div id="div_id_PropertiesFirstStage">
<hr>
<section id="properties-and-parameters-first-stage-ini" class="level3">
<h3 class="anchored" data-anchor-id="properties-and-parameters-first-stage-ini">Properties and parameters: first stage INI</h3>
<p><em>Table 5.3B. First stage INI file properties and parameters.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Header/Comments</td>
<td>“%” character indicates the beginning of a comment. Program will not process any characters that follow “%”. Use comments to add information and to better document the site. Each line of the INI file can be followed by a comment. Refer to the sample INI file for DSM site.</td>
</tr>
<tr class="even">
<td>Site_name</td>
<td>Name of the site. Any text can go here.</td>
</tr>
<tr class="odd">
<td>SiteID</td>
<td>This is the name attributed to the site in the database (e.g., DSM). Must be uppercase.</td>
</tr>
<tr class="even">
<td>Difference_GMT_to_local_time</td>
<td>Time difference between GMT time, that database is kept in, and the standard time at the site location. <code>local_time+Difference_GMT_to_local_time -&gt; GMT time</code>.</td>
</tr>
<tr class="odd">
<td>[Trace]</td>
<td>Marks the beginning of a new variable. The section has to end with the keyword <code>[End]</code>.</td>
</tr>
<tr class="even">
<td>variableName</td>
<td>Name of variable for first stage, following the Ameriflux naming convention. The variable with this name will show up in the subfolder “Clean” under the same folder where the original database file came from.</td>
</tr>
<tr class="odd">
<td>title</td>
<td>Descriptive variable name for plots/visualization.</td>
</tr>
<tr class="even">
<td>inputFileName</td>
<td>{<code>inputFileName</code>} The name of the database file that contains data for this trace. The brackets are mandatory.<br> The file name can include folder(s), e.g., <code>'Met/Tair'</code>, and the paths are relative to the main site path (<code>./Database/yyyy/SITEID</code>), so the above example translates into this filepath: <code>'./Database/yyyy/SITEID/Met/Tair'</code>.<br>Over the lifetime of a measurement site, the data logger programs can change and a sensor measurement that was assigned to a variable may change. To allow for different variable names over the site history the inputFileName can be given as: {<code>'inputFileName1','inputFileName2'</code>}. In this case, the parameter <code>inputFileName_dates</code> must be present and reflect this (see next parameter description).<br> Advanced: if there is a need to load up a data file from an alternative site, the path can be constructed as follows: <code>../../SITEID2/dataFolder</code>. This syntax <code>../../</code> moves the path pointer up two directory levels to <code>/Database/yyyy</code> and from there <code>SITEID2/dataFolder</code> takes the program to the correct folder.</td>
</tr>
<tr class="odd">
<td>inputFileName_dates</td>
<td><code>[datenum_start1 datenum_end1; datenum_start2 datenum_end2]</code> The start and end dates of data periods for each of the inputFileNames, using the Matlab <code>datenum</code> function. <br>If there are multiple inputFileNames per the example in the previous parameter description, e.g., {<code>'inputFileName1','inputFileName2'</code>} then the program needs to know the time periods when the data assigned to the variableName should come from <code>inputFileName1</code>, and when from <code>inputFileName2</code>. In that case, this field is mandatory.<br> If the inputFileName parameter contains only one file name, this inputFileName_dates parameter is optional, but it is still a good practice to use it anyway for documentation purposes and in case other filenames are added in the future.<br> The last <code>datenum_end</code> is usually set far into the future, e.g., <code>datenum(2999,1,1)</code>.</td>
</tr>
<tr class="even">
<td>measurementType</td>
<td>Usually <code>'Met'</code> or <code>'Flux'</code> (must be of Matlab type char). Mandatory parameter that sets the input and output trace folders. The input folder defaults to: <code>SITEID/measurementType/inputFileName</code>. If relative paths are used for the <code>inputFileName</code> parameter defined previously, the pipeline code “assumes” that the current folder is <code>SITEID/measurementType</code>, so the relative path is referenced to that. The output folder for the first stage cleaned trace is always <code>SITEID/measurementType/Clean</code>. <br>Note: the measurementType must <em>not</em> be missing (empty), otherwise the data will be saved to <code>SITEID/Clean/variableName</code> which is incorrect and will cause errors in future cleaning stages.</td>
</tr>
<tr class="odd">
<td>units</td>
<td>Measurement units for this trace must be data type char. Important!</td>
</tr>
<tr class="even">
<td>instrument</td>
<td>The name of the sensor that measures this trace, e.g., <code>'HMP155A'</code></td>
</tr>
<tr class="odd">
<td>instrumentSN</td>
<td>Serial number of the sensor, if available.</td>
</tr>
<tr class="even">
<td>Evaluate</td>
<td>Optional user-defined function. Examples: can be used to derive variables from available data; in flag variables to remove bad data; or for calculating new useful variables, e.g., <code>Evaluate = 'TA_1_1_1 = shiftMyData(clean_tv,TA_1_1_1,datenum(2021,11,07,03,00,0),60);'</code>. <!--See sample file `DSM_FirstStage.ini` for more use cases XXX.--></td>
</tr>
<tr class="odd">
<td>postEvaluate</td>
<td>Optional user-defined function, intended for more complex cases. Same functionality as <code>Evaluate</code> property, but <code>postEvaluate</code> is executed <em>after</em> all the other Trace properties. <!--See sample file `DSM_FirstStage.ini` for more use cases XXX.--></td>
</tr>
<tr class="even">
<td>loggedCalibration</td>
<td>Used together with currentCalibration (see next parameter). If you need to change the linear calibration for the trace, these coefficients are used to convert the trace values from engineering units to their original/raw units. Then the correct calibration coefficients (currentCalibration) are used. This can also be used to change the units. The format is <code>[gain offset startDatenum endDatenum]</code>, where <code>startDatenum</code> and <code>endDatenum</code> refer to the time span that this particular set of coefficients should be applied. For example, with no change for data starting on 1 January 2020, the code would read <code>loggedCalibration = [1 0 datenum(2020,1,1) datenum(2999,1,1)]</code>. You can apply multiple calibrations to different time periods, separated by semicolons.<br> Note: all calibration values need to be on the same line of code, i.e., no line-breaks are allowed in the INI file!</td>
</tr>
<tr class="odd">
<td>currentCalibration</td>
<td>Correct(ed) linear calibration coefficients. Used together with loggedCalibrations (see notes for previous parameter for more details).</td>
</tr>
<tr class="even">
<td>comments</td>
<td>Any useful comments relating to this trace and its handling in the INI file, such as why certain flags are applied.</td>
</tr>
<tr class="odd">
<td>minMax</td>
<td><code>[min max]</code> Minimum and maximum numerical thresholds for filtering. The values <em>outside</em> of this range will be set to NaN.</td>
</tr>
<tr class="even">
<td>clamped_minMax</td>
<td><code>[cMin cMax]</code> Similar to minMax but instead of setting the data points outside the range to NaN, it truncates their value to the cMin or cMax. (e.g., RH: [0 100]).<br>Note: this parameter is not mandatory, however, when used, please make sure that the minMax property boundaries are wider than the boundaries of clamped_minMax because the minMax property is applied first. This parameter is useful for variables such as relative humidity, e.g., <code>minMax = [-1 110]</code> used with <code>clamped_minMax=[0 100]</code>.</td>
</tr>
<tr class="odd">
<td>zeroPt</td>
<td>Value to indicate missing data. Many programs nowadays use -9999 to indicate bad/missing data points.</td>
</tr>
<tr class="even">
<td>dependent</td>
<td>Filter-dependent variables based on specified trace. The current trace can have multiple dependents that need to be separated by commas, e.g., <code>dependent = 'trace1','trace2','trace3'</code>.<br>For example, when using the LI-7200 pump, all the traces that depend on the LI-7200 are dependent on the pump trace. So, for the LI-7200: <code>dependent = 'CO2','H2O'</code>. Then the CO2 trace should have <code>dependent = 'FC',...</code> and so on. You can write these out manually where necessary or where this only occurs once or twice, but we highly recommend using the “tags” feature for common dependencies that are recurring.</td>
</tr>
<tr class="odd">
<td>[End]</td>
<td>Marks the end of the properties section for each trace.</td>
</tr>
</tbody>
</table>
<p><br> <strong>Note:</strong> Other properties that a user wants to use later on in their own programs (or in the “Evaluate” statements) can be added to each of the traces. The function that processes the INI files (read_ini_files.m) will add the property and its assigned value to the trace structure, but the rest of the Trace Analysis programs will ignore it. The user can then parse the trace info in their own programs (or within “Evaluate” statements) and take advantage of this feature.</p>
</section></div>
<p><br></p>
<div id="div_id_Tags">
<hr>
<section id="tags-for-dependent-variables" class="level3">
<h3 class="anchored" data-anchor-id="tags-for-dependent-variables">Tags for dependent variables</h3>
<p>As mentioned in the “dependent” parameter description in Table 5.1, you can use the tags feature to ensure that your INI file “catches” and filters all common dependent variables. This feature utilizes the Biomet library function <code>tags_Standard.m</code>. You should list the relevant tag in the “dependent” property field for it to work.</p>
<p>For example, given the standard tags, if you put <code>'tag_H2O_All'</code> in the dependent field for a trace, all traces listed under that tag will then be dependents of that trace. Tags can refer to other tags. You can also create site-specific custom tags by creating a <code>SITEID_CustomTags.m</code>, making sure to follow the same format as the tags in <code>tags_Standard.m</code>. (This optional file should live in the <code>Derived_Variables</code> folder; see figure 4.7 in section 5.1 for the location).</p>
<p>Tags in your site-specific custom file will <strong>overwrite</strong> tags of the same name in the <code>tags_Standard.m</code> file, and Matlab will warn you that this is occurring (by beeping and writing out a message to the screen).</p>
</section></div>
<p><br></p>
<div id="div_id_GlobVar_Include">
<hr>
<section id="global-variables-and-include-files" class="level3">
<h3 class="anchored" data-anchor-id="global-variables-and-include-files">Global variables and include files</h3>
<p>To simplify entering and editing the required parameters into the first stage INI file, there is an option to apply the same setting to many traces at once, using the “global variables” feature. At the top of the first stage INI template file (obtained in section 4.3), you will notice sections with headers containing “Global variables”. These are always defined at the beginning of the first stage INI file.</p>
<p>The main advantage of this feature is that it allows you to define a standard set of variables in templates called “include” files, which can be loaded into each site-specific INI file using the <code>#include</code> statement. We have provided samples of typical Met and EddyPro include files in the quick-start tutorial.</p>
<p>Another advantage is that you can apply changes to multiple traces all at once if needed, by making only one edit at the top of the file and then referencing this addition. This way, you do not risk missing multiple traces needing the same edit, so long as it is referenced correctly.</p>
<p>Note: only the main body of your first stage INI file, <em>not</em> your “include” files, should contain global variables.</p>
<p>There are two types of global variables, as follows:</p>
<ol type="a">
<li>Instrument-specific (<code>globalVars.Instrument</code>):</li>
</ol>
<ul>
<li>For the <em>instrument-specific</em> global variables, each trace has an <code>instrumentType</code> field. Currently we use five default instrument types (six if we consider an empty field <code>[]</code> as a type): LI7200, LI7700, Anemometer, EC, and otherTraces.</li>
<li>Example:
<pre>globalVars.Instrument.LI7200.instrumentSN  = '72H-1029'</pre>
applies this serial number to every trace which includes <code>instrumentType = 'LI7200'</code>.</li>
<li>You can also create your own unique sensor option for <code>instrumentType</code>, if you need to apply a setting to multiple traces.</li>
<li><code>otherTraces</code> has been depreciated so if an existing INI file contains this code (e.g., from an old template file), you can either set it to zero or remove those lines of code altogether (<code>otherTraces.Enable = 0</code>). If this is set to <code>1</code>, you will get warnings when you run cleaning.</li>
</ul>
<ol start="2" type="a">
<li>Trace-specific (<code>globalVars.Trace</code>):</li>
</ol>
<ul>
<li>Example:
<pre>globalVars.Trace.CH4.currentCalibration 
                  = [1000 0 datenum(2021,1,1) datenum(2999,1,1)]</pre>
applies this current calibration to the trace with <code>variableName = 'CH4'</code>.</li>
<li>Detailed explanation: in the INI file, the trace “CH4” has the field <code>currentCalibration</code> set to empty: <code>currentCalibration = []</code>. There is a global variable for the same trace with the correct <code>currentCalibration</code> field:
<pre>globalVars.Trace.CH4.currentCalibration 
                  = [1000 0 datenum(2021,1,1) datenum(2999,1,1)]</pre>
The final result is that the field <code>currentCalibration</code> for the trace “CH4” gets set to: <code>currentCalibration = [1000 0 datenum(2021,1,1) datenum(2999,1,1)]</code>.</li>
</ul>
<ol start="3" type="a">
<li>Other (<code>globalVars.other</code>):</li>
</ol>
<ul>
<li>For the third type of global variable, e.g., <code>globalVars.other</code>, currently you can use this to carry out single-point interpolation, for cases where just one half-hourly data point is missing:
<pre>globalVars.other.singlePointInterpolation = 'on'  % 'no_interp' - skip interpolation [default], 'on' - do single missing point interpolation for all traces</pre></li>
</ul>
<p><em>Adding <code>include</code> files to your First Stage INI file</em></p>
<p>In sections 4.1 and 4.2, we introduced <code>include</code> files and how they are obtained. These template files define a standard set of variables that can be loaded into your first stage INI file. Specifically, the files relate to EddyPro output and radiation components. We suggest browsing through these files to become familiar with the content. If you wish to change or add any settings, we strongly recommend leaving the template “include” files untouched and using the global variables feature to create or overwrite the relevant setting, as previously described.</p>
<p>More information about include files:</p>
<ul>
<li><code>EddyPro_Common_FirstStage_include.ini</code>: includes traces common to EddyPro output, listed in EddyPro file output order;</li>
<li><code>EddyPro_LI7200_FirstStage_include.ini</code>: when an LI-7200 IRGA is being used, this file adds LI-7200 specific traces, listed in EddyPro file output order;</li>
<li><code>EddyPro_LI7500_FirstStage_include.ini</code>: when an LI-7500 IRGA is being used, this file adds LI-7500 specific traces, listed in EddyPro file output order;</li>
<li><code>EddyPro_LI7500_FirstStage_include.ini</code>: when an LI-7500 IRGA is being used, this file adds LI-7500 specific traces, listed in EddyPro file output order;</li>
<li><code>RAD_FirstStage_include.ini</code>: includes radiation components.</li>
</ul>
<p>To include any of these files, add the following line of code to the very bottom of your first stage INI file: <code>#include &lt;relevant_file&gt;_include.ini</code>. If you are using more than one, put them on multiple lines of code, still at the very bottom of the INI file, as follows:</p>
<pre><code>#include EddyPro_Common_FirstStage_include.ini
#include EddyPro_LI7200_FirstStage_include.ini
#include RAD_FirstStage_include.ini</code></pre>
<p><em>How the global variables algorithm works:</em></p>
<ol type="1">
<li>The INI file trace parameters, i.e., all fields between [TRACE] and [END] in the INI file, are loaded up.</li>
<li>The program then cycles through all the traces: for each trace, first it checks if the <code>instrumentType</code> field matches one of the <code>globalVars.Instrument</code> fields, e.g., for <code>instrumentType = 'LI7700'</code> measuring “CH4”, if there is a <code>global.Instrument.LI7700</code> field, then all its fields would be applied to the CH4 trace, either creating a new field or overwriting the existing fields; i.e., the content of <code>global.Instrument.LI7700.instrumentSN</code> would replace the content of the CH4 field <code>instrumentSN</code>. Secondly, it checks if the trace <code>variableName</code> matches any of the <code>globalVars.Trace</code> fields, e.g.&nbsp;Trace “CH4”.</li>
<li>The program continues reading the INI file and applies all the settings from the [TRACE]-[END] section.</li>
<li>Next, it cycles through all the <code>globalVars.Instrument</code> fields and creates the fields or overwrites them if they already exist.</li>
<li>Finally, it goes through all the <code>globalVars.Trace</code> fields and creates or overwrites the fields.</li>
<li>Then the program moves to the next trace and repeats steps 2–5.</li>
</ol>
</section></div>
<p><br></p>
<div id="div_id_Outlier">
<hr>
<section id="outlier-detection" class="level3">
<h3 class="anchored" data-anchor-id="outlier-detection">Outlier detection</h3>
<p>As outlined earlier on this page, the <code>Evaluate</code> feature can be used to implement Matlab code. This can be useful for removing outliers from your data in the first stage. For example, in the <code>Biomet</code> library there are some existing functions to help with this, such as:</p>
<ol type="1">
<li><code>remove_spikes_diurnal_nonParametric.m</code></li>
<li><code>run_std_dev.m</code></li>
</ol>
<p>Alternatively, you could include your own code to do this, depending on what you need.</p>
</section></div>
<p><br></p>
<div id="div_id_Overwrite">
<hr>
<section id="overwrite-feature" class="level3">
<h3 class="anchored" data-anchor-id="overwrite-feature">Overwrite feature</h3>
<p>Sometimes we need to overwrite multiple properties for one or more traces that have already been created e.g.&nbsp;in an include file. The global variables feature allows this, however, once this section becomes long with many trace property tweaks, it can become very hard to troubleshoot, and in these cases having all the information for one trace together is more desirable.</p>
<p>Instead of using global variables you can duplicate the full trace (<code>[Trace] ... [End]</code>), and in your site-specific first stage INI file, put this duplicate <em>after</em> the line of code where the include file is called that contains your original trace. Note the additional <code>Overwrite</code> property highlighted in yellow:</p>
<p><img src="images/ini_files/ini_example1a.jpg" alt="INIfiles/OverwriteFeature" width="650"></p>
<p><em>Figure 5.3C. Location within site-specific INI file to put duplicate trace for overwriting a trace previously defined in an include INI file. In this case, we want to overwrite the <code>CH4_MIXING_RATIO</code> trace that was originally defined in <code>EddyPro_LI7700_FirstStage_include.ini</code>. Yellow highlighting shows the syntax for the “overwrite” property.</em></p>
<p>There are three overwrite options:</p>
<ul>
<li><p><code>0</code> = do not overwrite with this trace. This is the default setting. If you do not include the <code>Overwrite</code> parameter, the pipeline assumes this option. If you have a duplicate trace, you will get an <strong>error</strong> during cleaning (Example 1):</p>
<p><img src="images/ini_files/ini_example1c1.jpg" alt="INIfiles/OverwriteFeatureEx1" width="300"></p></li>
<li><p><code>1</code> = overwrite traces having the same variableName and also with <code>Overwrite = 0</code> setting. This puts the duplicate data where the original data was, i.e., complete overwrite, first trace gone. Use this setting if you want your duplicate T2 available to use in a later variable such as T3, T4, T5, etc. (Example 2):</p>
<p><img src="images/ini_files/ini_example1c2.jpg" alt="INIfiles/OverwriteFeatureEx2" width="600"></p></li>
<li><p><code>2</code> = overwrite traces having the same variableName and with <code>Overwrite = 0</code> setting. This takes advantage of the “position” of the duplicate trace. Use this setting if you want a later variable such as T3 or T4 available to use in T2.</p>
<p><img src="images/ini_files/ini_example1c3.jpg" alt="INIfiles/OverwriteFeatureEx3" width="600"></p></li>
</ul>
</section></div>
<p><br></p>
<div id="div_id_Eval">
<hr>
<section id="more-about-evaluate-and-postevaluate-order-of-operations" class="level3">
<h3 class="anchored" data-anchor-id="more-about-evaluate-and-postevaluate-order-of-operations">More about Evaluate and postEvaluate: order of operations</h3>
<p>More complex user-defined processing can be applied in the first stage to any trace using the very useful “Evaluate” and new “postEvaluate” options. Matlab functions (user-written or from <code>Biomet.net</code>) can be called from this statement. Multiple Matlab statements can be called from within the “Evaluate” or “postEvaluate” strings. They can be used to derive variables from available data, flag variables to remove bad data, or to calculate new useful variables. Here is an <code>Evaluate</code> example for removing outliers from a trace:</p>
<pre><code>Evaluate = 'wlen=24;thres=4;TA_1_1_1 = run_std_dev(TA_1_1_1,clean_tv,wlen,thres);'</code></pre>
<p>The <code>Evaluate</code> property is executed for all traces <em>before</em> any other cleaning properties, e.g., minMax, calibration, etc.. In contrast, the newer <code>postEvaluate</code> property is executed in the first stage <em>after</em> all other cleaning is done.</p>
<p>Generally speaking, the order of operations is:</p>
<p><code>Evaluate</code> –&gt; <code>other cleaning (e.g., minMax, calibration)</code> –&gt; <code>postEvaluate</code>.</p>
<p>This is <strong><em>regardless of the order that they appear</em></strong> &nbsp;within <code>[Trace] ... [End]</code>. The following series of examples shows how the Evaluate and postEvaluate statements work in relation to the other cleaning properties. For each example the input (Original) is an array of ones, and both the “Original” and first-stage “Clean” data are plotted in the result.</p>
<p><strong>Example 1:</strong> Only minMax and calibration, no Evaluate or postEvaluate statements<br>
<img src="images/ini_files/ini_example1b1.jpg" alt="INIfiles/postEvaluateEx1" width="650"></p>
<p>Result: x = 2x [calibrated]<br>
<img src="images/ini_files/ini_example1b1_fig.jpg" alt="INIfiles/postEvaluateEx1" width="400"></p>
<p><br></p>
<p><strong>Example 2:</strong> Evaluate, minMax and calibration, no postEvaluate statement<br>
<img src="images/ini_files/ini_example1b2.jpg" alt="INIfiles/postEvaluateEx2" width="650"></p>
<p>Result: x = (x - 1)*2 [Evaluate first, then calibrate]<br>
<img src="images/ini_files/ini_example1b2_fig.jpg" alt="INIfiles/postEvaluateEx2" width="400"></p>
<p><br></p>
<p><strong>Example 3:</strong> minMax and calibration, postEvaluate statement, no Evaluate statement<br>
<img src="images/ini_files/ini_example1b3.jpg" alt="INIfiles/postEvaluateEx3" width="650"></p>
<p>Result: x = 2x - 1 [calibrate, then postEvaluate]<br>
<img src="images/ini_files/ini_example1b3_fig.jpg" alt="INIfiles/postEvaluateEx3" width="400"></p>
<p><br></p>
<p><strong>Example 4:</strong> minMax and calibration, both Evaluate and postEvaluate statements<br>
<img src="images/ini_files/ini_example1b4.jpg" alt="INIfiles/postEvaluateEx4" width="650"></p>
<p>Result: x = (x - 1)*2 - 1 [Evaluate, then calibrate, then postEvaluate]<br>
<img src="images/ini_files/ini_example1b4_fig.jpg" alt="INIfiles/postEvaluateEx4" width="400"></p>
</section></div>
<p><br></p>
<!-- <div id="div_id_CreateFromAmeriflux">

<hr>

#### Creating INI file from Ameriflux data

[XXX Add details once I've tested this] Instead of duplicating INI files and rename... Create first stage cleaning INI file from template using `createFirstStageIni` - quick way to put ALL traces from specified folder into template first stage file. Not a good option if starting from Met/Flux folders with EddyPro (1000s of traces), but a good option if starting from Ameriflux downloads (20-50 traces).

</div> -->
<p><br></p>
<div id="div_id_SyntaxRules">
<hr>
<section id="programming-syntax-rules-for-first-and-second-stage-ini-files" class="level3">
<h3 class="anchored" data-anchor-id="programming-syntax-rules-for-first-and-second-stage-ini-files">Programming syntax rules for first and second stage INI files:</h3>
<pre><code>Some programming rules that you must follow for the first and second stage INI files to be successfully read by the pipeline scripts:

1. We enforce using uppercase for site IDs to avoid problems with running data cleaning on Mac vs. Windows.
2. All traces must be enclosed in [Trace] and [End] blocks.
3. All assignments can be on multiple lines but should be enclosed in single quotes.
4. Comments must begin with a percentage sign (%).
5. All fields must be in Matlab format.
6. All parameter assignments must be to strings in single quotes, or numeric expressions, e.g., threshold_const = 6, threshold_const = [6], variableName = 'Some Name'.
7. For the first stage, the partial path must be included with the inputFileName when you locate the raw data trace in the database. (Using biomet_path function only returns the path: /year/SITEID/measType/)
8. First stage necessary fields are: variableName, inputFileName, measurementType, units, title, and minMax.
9. Second stage necessary fields are: variableName, title, units.</code></pre>
</section></div>
<div id="div_id_TipsINI">
<hr>
<p><strong>TIPS</strong><br>
Once your INI file is complete, if desired you can use the <code>simplify_FirstStageIni()</code> function to clean it up. This may be helpful if you used a legacy INI file as an example; the function removes obsolete fields and makes things more concise.</p>
</div>


</section></main></div>






















 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
 <!-- /content -->




</body></html>