<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>data_visualization – EcoFlux Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/lab_logo/No_text_smaller.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">EcoFlux Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Documentation/index.html"> 
<span class="menu-text">Documentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Data.html"> 
<span class="menu-text">Field Sites &amp; Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../OutreachNews.html"> 
<span class="menu-text">Outreach and News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../PipelineDocumentation/PipelineDocumentation.html" aria-current="page"> 
<span class="menu-text">Pipeline Documentation</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ecoflux-lab"> <i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../PipelineDocumentation/7_Data_Visualization.html">7. Data Visualization</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/PipelineDocumentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pipeline Documentation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/1_Motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Motivation: The Importance of Flux Data Standardization and Reproducibility</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/1_0_Note_High_Freq_Data_Processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.0 &nbsp; Note: High Frequency Data Processing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/2_SoftwareInstallation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Software Installation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_1_Install_Git_Optional.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.1 &nbsp; Install Software: Git (optional)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_2_Clone_Biomet_Library.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.2 &nbsp; Clone Biomet Library</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_3_Install_Matlab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.3 &nbsp; Install Software: Matlab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_4_Configure_Matlab_For_Biomet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.4 &nbsp; Configure Matlab for Biomet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_5_Install_R_Studio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.5 &nbsp; Install Software: R/RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/2_6_Install_Python_Optional.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.6 &nbsp; Install Software: Python (optional)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/3_Data_Cleaning_Principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Data Cleaning Principles</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/4_Quick_Start_Set_Up_Structure_Config.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Quick Start: Project Directory Structure</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/5_Quick_Start_Create_Database.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Quick Start: Create Database</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/5_1_Quick_Start_Create_Database.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5.1 &nbsp; Quick Start: Create Database and Visualize</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/6_Quick_Start_Create_INI_Files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Quick Start: Create INI Files for Data Cleaning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/6_1_Quick_Start_Create_First_Stage_INI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6.1 &nbsp; Quick Start: First Stage INI File</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/6_2_Quick_Start_Create_Second_Stage_INI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6.2 &nbsp; Quick Start: Second Stage INI File</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/6_3_Quick_Start_Third_Stage_Ameriflux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6.3 &nbsp; Quick Start: Third Stage and Ameriflux Output</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/7_Data_Visualization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">7. Data Visualization</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../PipelineDocumentation/8_Troubleshooting_FAQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Troubleshooting and FAQ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../PipelineDocumentation/8_0_Recommended_Software_Versions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8.0 &nbsp; Recommended Software Versions</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-visualization-apps" id="toc-data-visualization-apps" class="nav-link active" data-scroll-target="#data-visualization-apps">7. &nbsp; Data Visualization Apps</a>
  <ul class="collapse">
  <li><a href="#plotting-data-using-plotapp-function" id="toc-plotting-data-using-plotapp-function" class="nav-link" data-scroll-target="#plotting-data-using-plotapp-function">Plotting data using <code>plotApp</code> function</a></li>
  <li><a href="#plotting-data-using-r-shiny-app" id="toc-plotting-data-using-r-shiny-app" class="nav-link" data-scroll-target="#plotting-data-using-r-shiny-app">Plotting data using R Shiny app</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="data-visualization-apps" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization-apps">7. &nbsp; Data Visualization Apps</h2>
<p><link rel="stylesheet" href="css/style.css"></p>
<p>Matlab functions for visualizing data:</p>
<ul>
<li><code>gui_Browse_Folder</code>: given a filepath, this function will open a new figure window and provide a dropdown containing all traces located at that filepath location. You can pick one or scroll through using the arrow buttons.<br>
</li>
<li><code>guiPlotTraces</code><br>
</li>
<li><code>plotApp</code>.</li>
</ul>
<p><strong>Note</strong>: there is also an R Shiny App (see below) <br></p>
<section id="plotting-data-using-plotapp-function" class="level3">
<h3 class="anchored" data-anchor-id="plotting-data-using-plotapp-function">Plotting data using <code>plotApp</code> function</h3>
<p><code>plotApp</code> is a Matlab graphical user interface (GUI) made to facilitate visualization of database traces as:<br>
(i) Basic time series;<br>
(ii) Statistical summary;<br>
(iii) Comparison amongst traces; and<br>
(iv) Comparisons amongst stages.</p>
<section id="quick-start-plotapp-instructions" class="level4">
<h4 class="anchored" data-anchor-id="quick-start-plotapp-instructions">Quick Start <code>plotApp</code> Instructions:</h4>
<ul>
<li><p>In Matlab, run <code>plotApp</code> on the command line (figure 7.1).</p>
<p><img src="images/visualization/CommandLine.jpg" alt="plotApp:CommandLine" width="250"></p>
<p><em>Figure 7.1. How to launch the plotApp GUI in Matlab.</em></p></li>
<li><p>The GUI in figure 7.2 will launch; specify the folder containing the database you would like to plot by typing the folder path or by clicking the folder button and navigating to the desired folder.</p>
<ul>
<li>You need to specify the <code>\Database\</code> folder (immediately beneath your project folder) rather than the individual year or site folder.</li>
<li>The <em>Year</em> and <em>Site</em> will be chosen from the drop-down menus which are automatically populated based on what is available in the folder.</li>
<li>If you type in the folder path manually or paste it into the Folder field, press ‘Enter’ when complete.</li>
<li>On subsequent uses of plotApp, it will remember the last Folder that was entered.</li>
</ul>
<p><img src="images/visualization/plotApp1.jpg" alt="plotApp:GUI1" width="500"></p>
<p><em>Figure 7.2. plotApp GUI showing where to enter the Database folder to view and analyze data.</em></p></li>
<li><p>Next, select the <em>Year</em>, <em>Site</em>, and <em>Data type</em> (Flux, Met, Clean, etc.) that you want to plot.</p></li>
<li><p><em>Flux</em> and <em>Met</em> data type are associated with <em>Raw</em> and <em>Stage1</em> traces. <em>Clean</em> data type is associated with <em>Stage2</em> and higher.</p></li>
<li><p>Once these selections are made, the ‘Traces’ list will populate; then click on a trace to select it and plot the time series (figure 7.3).</p>
<p><img src="images/visualization/plotApp2.jpg" alt="plotApp:GUI2" width="500"></p>
<p><em>Figure 7.3. Example of plotApp GUI showing time series plotted after selecting data.</em></p></li>
<li><p>You can use the Matlab window navigation tools (i.e., zoom, pan, data tips) to explore the traces.</p></li>
<li><p>Two traces can be plotted at once for quick and easy reference, or for qualitative visual comparisons.</p></li>
</ul>
</section>
<section id="trace-analysis" class="level4">
<h4 class="anchored" data-anchor-id="trace-analysis">Trace Analysis</h4>
<p>The Trace analysis drop-down menu has four options:<br>
(i) Single trace;<br>
(ii) Plot parents;<br>
(iii) Compare traces; and<br>
(iv) Compare Stages (coming soon…).</p>
<ul>
<li>Options (i), (ii), and (iv) operate on a single trace, which is defined by the ‘Trace’ selector <img src="images/visualization/TraceButton.jpg" width="75"> (i.e., 1 or 2, upper or lower panel, respectively).</li>
<li>Option (iv) compares the selected trace with its previous stage.</li>
<li>Options (iii) operates on both Trace 1 and 2.</li>
</ul>
<p><em>Single Trace</em></p>
<p>A basic summary of a single trace can be plotted using the <em>Trace analysis</em> drop-down menu.</p>
<ul>
<li><p>For the single trace summary, first select Trace ‘1’ (upper panel) or ‘2’ (lower panel) using the up/down buttons.</p></li>
<li><p>From the <em>Trace analysis</em> drop-down menu, select ‘Single trace’.</p></li>
<li><p>A new window will open with the trace summary (figure 7.4).</p>
<p><img src="images/visualization/plotAppFig1.jpg" alt="plotApp:Fig1" width="500"></p>
<p><em>Figure 7.4. Example of single-trace summary in plotApp GUI.</em></p></li>
</ul>
<p>The four panel ’Single trace’ summary includes (i) upper left – raw half-hourly data and daily average; (ii) upper right – diurnal trend using boxplots on an hourly basis; (iii) lower left – Q-Q plot; and (iv) lower right – cumulative distribution with 1st and 99th percentile, mean, and median printed.</p>
<ul>
<li>Panels (ii)–(iv) are a summary of the raw data in panel (i).</li>
<li>Users can interact with panel (i) using the Matlab navigation tools (zoom and pan only) to analyze a subset of the data.</li>
<li>After zooming/panning, panels (ii)–(iv) will automatically update.</li>
<li>To restore the view to the whole data set, with zoom out selected, double-click panel (i). Alternately, right click on panel (i) and select ‘Restore view’ from the drop-down.</li>
</ul>
<p><em>Compare traces</em></p>
<p>A basic comparison of Trace ‘1’ and ‘2’ can be plotted using the <em>Trace analysis</em> drop-down menu and selecting ‘Compare traces’.</p>
<ul>
<li><p>A new window will open with the trace comparison (figure 7.5).</p></li>
<li><p>Any two traces can be compared. There are no restrictions on <em>Site</em>, <em>Data</em> type or <em>Level</em>, but currently the <em>Year</em> must be the same for each trace.</p></li>
<li><p>An error message will appear if only one trace is plotted or if Year doesn’t match.</p>
<p><img src="images/visualization/plotAppFig2.jpg" alt="plotApp:Fig2" width="500"></p>
<p><em>Figure 7.5. Example of ‘Compare trace’ summary in plotApp GUI.</em></p></li>
</ul>
<p>The four panel ‘Plot comparison’ summary includes (i) upper left – raw half-hourly residuals and their daily average; (ii) upper right – normalized cross-covariance for +/- 48 measurement intervals; (iii) scatter plot comparing the two traces; and (iv) lower right – cumulative distribution of the residuals.</p>
<ul>
<li>As for the single-trace analysis, users can interact with panel (i) using the Matlab navigation tools (zoom and pan only) to analyze a subset of the data.</li>
<li>After zooming/panning, panels (ii)–(iv) will automatically update.</li>
<li>To restore the view to the whole data set, with zoom out selected, double-click panel (i). Alternately, right click on panel (i) and select ‘Restore view’ from the drop-down.</li>
<li>Panel (ii) displays the lag with the highest cross-covariance between the two traces for data visible in panel (i).</li>
<li>Panel (iii) displays the slope and intercept of the linear regression between the two traces, along with the r<sup>2</sup> value for data visible in panel (i).</li>
<li>Panel (iv) displays the root mean squared error (RMSE), mean absolute deviation (MAD), mean, and median of the residuals in panel (i).</li>
</ul>
<p><em>Plot parents</em></p>
<ul>
<li><p>The <em>Trace analysis</em> option is meant to aid the assessment of data cleaning amongst stages. For example, if more data is removed due to data cleaning than expected, <em>Plot parents</em> can be used to help identify which parent trace resulted in data removal.</p></li>
<li><p>The ‘Trace’ selector (i.e., 1 or 2) defines which trace will be analyzed and displays the analysis in a new window (figure 7.6).</p>
<p><img src="images/visualization/plotAppParents.jpg" alt="plotApp:parents" width="600"></p>
<p><em>Figure 7.6. Example of ‘plot parents’ display in plotApp GUI.</em></p></li>
<li><p>For a particular stage, ‘Plot parents’ shows the data from the current stage (orange circles, upper panel) and contrasts with the previous stage (i.e.&nbsp;blue circles, upper panel).</p></li>
<li><p>The minMax=[] bounds for the trace defined in the .ini file for the particular site are shown in the upper panel in yellow and purple.</p></li>
<li><p>The lower panel shows all the parents of a particular trace (i.e., those traces which include that trace as a dependent=’’ in the INI file). Note, dependents are often called using ‘tags’.</p></li>
<li><p>In the lower panel, 0 - SELF refers to data which are missing before cleaning based on dependents.</p></li>
<li><p>For all other parents, a large dot indicates a point which was removed from the selected trace which was not missing in the previous stage. A small dot indicates the data from the selected trace would be removed based on the parent, but was already missing from the previous stage.</p></li>
<li><p>Users can interact with the figure using the Matlab navigation tools (e.g., zoom and pan) to view a subset of the data.</p>
<ul>
<li>It is recommended that you only zoom/pan the top panel.</li>
<li>The x-axis of the top and bottom panels are linked, so navigating in one panel will automatically update the x-axis on the corresponding panel.</li>
</ul></li>
</ul>
<p><em>Compare traces</em></p>
<p>This option in <em>Trace analysis</em> is intended to quickly assess what changes occurred between stages for a particular trace.</p>
<p><br></p>
</section>
</section>
<section id="plotting-data-using-r-shiny-app" class="level3">
<h3 class="anchored" data-anchor-id="plotting-data-using-r-shiny-app">Plotting data using R Shiny app</h3>
<p>Instructions for using the <code>RShiny_flux_plots.R</code> app (under <code>./Biomet.net/R/RShiny_flux_plots</code>)</p>
<p>To run the R Shiny App, either locally or on an RShiny server, you will need to download, edit, rename and save two files.</p>
<ol type="1">
<li>Download the <code>Excel sheet</code> below to input your site coordinates (you can include multiple sites, each as a separate line).</li>
</ol>
<p><a href="ini_templates_sample_data/site_coordinates_TUT.xlsx">Example site coordinate file</a></p>
<ul>
<li><p><strong>Note</strong> that the standard meridian is equal to your UTC offset (without daylight savings) x 15 (e.g., Vancouver is UTC-8 so the standard meridian is -120)</p></li>
<li><p>Also, latitude and longitude are in decimal degrees and negative for West and South coordinates</p></li>
</ul>
<ol start="2" type="1">
<li><p>Now save the excel file under <code>Calculation_Procedures/SITE/</code> (i.e., where your other site-specific ini files are). You should rename the file to include your specific <code>Project Name</code>.</p></li>
<li><p>Download the example <code>ini file</code>.</p></li>
</ol>
<p><a href="ini_templates_sample_data/TUT_RShiny_ini.R.zip">Example R Shiny ini file</a></p>
<ol start="4" type="1">
<li><p>Edit the ini file and rename the paths to match your local computer</p></li>
<li><p>Select which level(s) you would like to plot (e.g., You can plot <code>ThirdStage</code> data by specifying <code>level &lt;- "Clean/ThirdStage"</code>, or multiple levels of data using the concatenate command like <code>level &lt;- c("Clean/ThirdStage","Met")</code>.</p></li>
<li><p>Rename the file to include your specific <code>Project Name</code> and save it in under <code>Calculation_Procedures/SITE/</code> (i.e., where your other site-specific ini files are).</p></li>
<li><p>Now you can run the R Shiny App by editing the paths in the code below and running it in the R console (<strong>make sure to change the paths name to match your computer</strong>)</p></li>
</ol>
<pre>source("/Users/saraknox/Code/local_data_cleaning/Projects/EcoFlux/Database/Calculation_Procedures/RShiny_flux_plots_ini/UQAM_ini.R")

source("/Users/saraknox/Code/Biomet.net/R/RShiny_flux_plots/load_save_data.R")
    
shiny::runApp("/Users/saraknox/Code/Biomet.net/R/RShiny_flux_plots/RShiny_flux_plots.R") 
</pre>
<p><strong>Note</strong>: if you get an error installing the package <code>imager</code>, you may need to try:</p>
<p>For <code>imager</code>, you may need to download quartz to be able to run this library properly (https://www.xquartz.org) &amp; then use <code>install.packages("igraph", type="binary")</code></p>
<!-- 1. Create a visualization INI file for your site (see examples in the `Biomet.net` library under `Biomet.net/R/data_visualization_EcoFlux/ini_files/`; not to be confused with data-cleaning INI files). 
[XXX Sara: the examples in here vary a bit, and are a bit long and confusing... can I just use RShiny_flux_plots_ini/EcoFlux_ini.R as a template for the instructions?]

2. Make a new directory in your `Calculation_Procedures` directory called `RShiny_flux_plots_ini`, and put this INI file there. Edit the relevant directory paths in this INI file for your own local computer.

3. You will also need to include an XLSX file with your site coordinates (format shown in figure 7.1), in the same directory as the INI file.

2. In your R console, edit and enter the following (note that you can also create an R script with the code below and run the R script):

    a. `source("/Users/<username>/Code/local_data_cleaning/Projects/EcoFlux/Database/Calculation_Procedures/RShiny_flux_plots_ini/EcoFlux_ini.R")` [XXX does it matter where the INI and xlsx files are stored so long as they are sourced properly here?] no just create plotting INI file in their cal_proc directory

    b.
    `source("/Users/<username>/Biomet.net/R/RShiny_flux_plots/load_save_data.R")`
    
    c. Run 'RShiny_flux_plots.R' and include your local path to the file
    `shiny::runApp("/Users/<username>/Biomet.net/R/RShiny_flux_plots/RShiny_flux_plots.R")` -->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>